<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - KaosSub</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon/favicon.ico">
    <link rel="icon" type="image/png" href="/assets/favicon/favicon.png">
    <link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg">
    <link rel="apple-touch-icon" href="/assets/favicon/favicon.png">
    <link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg">
    <meta name="theme-color" content="#dc3545">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #343a40, #495057);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #007bff;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .admin-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .otp-form {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
        
        .otp-input {
            font-size: 24px;
            text-align: center;
            letter-spacing: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-nav .btn {
            background: #6c757d;
            color: white;
        }
        
        .admin-nav .btn:hover {
            background: #545b62;
        }
        
        .recent-orders {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .order-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-status.success {
            color: #28a745;
            font-weight: bold;
        }
        
        .order-status.failed {
            color: #dc3545;
            font-weight: bold;
        }
        
        .hidden {
            display: none;
        }

        .badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
}

.badge-success {
    background-color: #28a745;
    color: white;
}

.badge-secondary {
    background-color: #6c757d;
    color: white;
}

.badge-warning {
    background-color: #ffc107;
    color: #212529;
}

.badge-info {
    background-color: #17a2b8;
    color: white;
}

.badge-danger {
    background-color: #dc3545;
    color: white;
}

.btn-sm {
    padding: 5px 10px;
    font-size: 12px;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}
    </style>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>KaosSub</h1>
        <nav style="display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap; margin-top: 1rem;">
            <a href="/" style="text-decoration: none; color: #333; font-weight: 500;">Home</a>
            <a href="/dashboard" style="text-decoration: none; color: #333; font-weight: 500;">Dashboard</a>
            <a href="/admin" style="text-decoration: none; color: #333; font-weight: 500;">Admin</a>
            <a href="/data-plans" style="text-decoration: none; color: #333; font-weight: 500;">Data Plans</a>
            <a href="/contact" style="text-decoration: none; color: #333; font-weight: 500;">Contact</a>
        </nav>
        </header>

        <main>
            <div class="admin-container">
                <!-- OTP Verification Section -->
                <div id="otpSection" class="admin-section">
                    <div class="otp-form">
                        <h2>Admin Verification Required</h2>
                        <p>To access the admin dashboard, please verify your identity with an OTP.</p>
                        
                        <button onclick="requestOTP()" class="btn" id="requestOtpBtn">
                            Send OTP to Email
                        </button>
                        
                        <div id="otpInputSection" class="hidden" style="margin-top: 20px;">
                            <p>Enter the OTP sent to your email:</p>
                            <input type="text" id="otpCode" class="form-control otp-input" maxlength="6" placeholder="000000">
                            <button onclick="verifyOTP()" class="btn" id="verifyOtpBtn" style="margin-top: 10px;">
                                Verify OTP
                            </button>
                        </div>
                        
                        <div id="otpMessage" style="margin-top: 15px;"></div>
                    </div>
                </div>

                <!-- Admin Dashboard (hidden until OTP verification) -->
                <div id="adminDashboard" class="hidden">
                    <div class="admin-header">
                        <h1>Admin Dashboard</h1>
                        <p>Welcome back, <span id="adminName">Admin</span>!</p>
                    </div>

                    <div class="admin-nav">
    <button class="btn" onclick="loadStats()">Refresh Stats</button>
    <button class="btn" onclick="loadUserManagement()">User Management</button>
    <button class="btn" onclick="loadOrderManagement()">Order Management</button>
    <button class="btn" onclick="loadSystemSettings()">System Settings</button>
    <button class="btn" onclick="adminLogout()" style="background: #dc3545;">Logout Admin</button>
</div>

                    <!-- Statistics Section -->
                    <div class="admin-section">
                        <h2>üìä System Overview</h2>
                        <div class="stats-grid" id="statsGrid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalUsers">0</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalOrders">0</div>
                                <div class="stat-label">Total Orders</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalRevenue">‚Ç¶0</div>
                                <div class="stat-label">Total Revenue</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="successRate">0%</div>
                                <div class="stat-label">Success Rate</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders Section -->
                    <div class="admin-section">
                        <h2>üìã Recent Orders</h2>
                        <div class="recent-orders" id="recentOrders">
                            <p>Loading recent orders...</p>
                        </div>
                    </div>

                    <!-- User Management Section -->
                    <div class="admin-section hidden" id="userManagementSection">
        <h2>üë• User Management</h2>
        <p>Manage user accounts, roles, and permissions.</p>
        <div id="userManagementContent">
            <p>Loading user data...</p>
        </div>
    </div>

                    <!-- Order Management Section -->
                    <div class="admin-section hidden" id="orderManagementSection">
        <h2>üõí Order Management</h2>
        <p>View and manage all data purchase orders.</p>
        <div id="orderManagementContent">
            <p>Loading order data...</p>
        </div>
    </div>

                    <!-- System Settings Section -->
                    <div class="admin-section hidden" id="systemSettingsSection">
        <h2>‚öôÔ∏è System Settings</h2>
        <p>Configure system-wide settings and preferences.</p>
        <div id="systemSettingsContent">
            <p>Loading system settings...</p>
        </div>
    </div>
                </div>

                <!-- Access Denied Section -->
                <div id="accessDeniedSection" class="admin-section hidden">
                    <div style="text-align: center; color: #dc3545;">
                        <h2>üö´ Access Denied</h2>
                        <p>You do not have administrator privileges to access this page.</p>
                        <a href="/dashboard" class="btn">Go to Dashboard</a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Check for existing admin session on page load
document.addEventListener('DOMContentLoaded', function() {
    
    // First check if user is authenticated
    if (!Utils.isAuthenticated()) {
        document.getElementById('accessDeniedSection').classList.remove('hidden');
        return;
    }
    
    // Check admin status
    checkAdminStatus();
});

// Check admin status and session
async function checkAdminStatus() {
    try {
        const response = await Utils.apiRequest('/api/admin/check-status');
        
        if (response.success && response.data.is_admin) {
            // User is admin, check for valid session
            if (AdminSession.hasValidSession()) {
                document.getElementById('otpSection').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                loadStats();
            } else {
                document.getElementById('otpSection').classList.remove('hidden');
            }
        } else {
            document.getElementById('accessDeniedSection').classList.remove('hidden');
        }
    } catch (error) {
        console.error('‚ùå Failed to check admin status:', error);
        document.getElementById('accessDeniedSection').classList.remove('hidden');
    }
}
        // Request OTP
        async function requestOTP() {
            const button = document.getElementById('requestOtpBtn');
            const originalText = Utils.showLoading(button);

            try {
                const response = await Utils.apiRequest('/api/admin/request-otp', {
                    method: 'POST'
                });

                if (response.success) {
                    showMessage('OTP sent successfully! Check your email (and console for demo).', 'success');
                    document.getElementById('otpInputSection').classList.remove('hidden');
                    document.getElementById('otpCode').focus();
                } else {
                    showMessage(response.error || 'Failed to send OTP', 'error');
                }
            } catch (error) {
                showMessage(error.message, 'error');
            } finally {
                Utils.hideLoading(button, originalText);
            }
        }

        // Verify OTP
async function verifyOTP() {
    const otpCode = document.getElementById('otpCode').value;
    const button = document.getElementById('verifyOtpBtn');
    
    if (!otpCode || otpCode.length !== 6) {
        showMessage('Please enter a valid 6-digit OTP', 'error');
        return;
    }

    const originalText = Utils.showLoading(button);

    try {
        const response = await Utils.apiRequest('/api/admin/verify-otp', {
            method: 'POST',
            body: JSON.stringify({ otp_code: otpCode })
        });
        
        if (response.success) {
            // Save admin session
            AdminSession.saveSession(response.data.session);
            
            showMessage('Admin verification successful!', 'success');
            
            // Show admin dashboard
            document.getElementById('otpSection').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            
            // Load initial data
            loadStats();
        } else {
            showMessage(response.error || 'Invalid OTP', 'error');
        }
    } catch (error) {
        showMessage(error.message, 'error');
    } finally {
        Utils.hideLoading(button, originalText);
    }
} 

        // Load admin statistics
        async function loadStats() {
            try {
                const response = await Utils.apiRequest('/api/admin/stats');

                if (response.success) {
                    const stats = response.data;

                    // Update stats display
                    document.getElementById('totalUsers').textContent = stats.total_users;
                    document.getElementById('totalOrders').textContent = stats.total_orders;
                    document.getElementById('totalRevenue').textContent = Utils.formatCurrency(stats.total_revenue);

                    // Calculate success rate (simplified)
                    const successRate = stats.total_orders > 0 ? '95%' : '0%';
                    document.getElementById('successRate').textContent = successRate;

                    // Display recent orders
                    displayRecentOrders(stats.recent_orders);
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Display recent orders
        function displayRecentOrders(orders) {
            const container = document.getElementById('recentOrders');

            if (!orders || orders.length === 0) {
                container.innerHTML = '<p>No recent orders found.</p>';
                return;
            }

            container.innerHTML = orders.map(order => `
                <div class="order-item">
                    <div>
                        <strong>${order.profiles?.email || 'Unknown User'}</strong>
                        <div style="font-size: 12px; color: #666;">
                            ${order.networks?.name} - ${order.data_plans?.name}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="order-status ${order.status}">${order.status}</div>
                        <div style="font-size: 12px; color: #666;">
                            ${Utils.formatCurrency(order.amount_paid)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Navigation functions
        function showUserManagement() {
            hideAllSections();
            document.getElementById('userManagementSection').classList.remove('hidden');
        }

        function showOrderManagement() {
            hideAllSections();
            document.getElementById('orderManagementSection').classList.remove('hidden');
        }

        function showSystemSettings() {
            hideAllSections();
            document.getElementById('systemSettingsSection').classList.remove('hidden');
        }

        function hideAllSections() {
            const sections = [
                'userManagementSection',
                'orderManagementSection',
                'systemSettingsSection'
            ];

            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
        }

        // Utility function to show messages
        function showMessage(message, type) {
        if (message && typeof message === "object") {
            message = message.message || JSON.stringify(message);
        }
            const messageDiv = document.getElementById('otpMessage');
            messageDiv.textContent = message;
            messageDiv.className = `alert alert-${type}`;
            messageDiv.style.display = 'block';
        }
</script>
    <script src="js/app.js"></script>
    <script>// User Management Functions
async function loadUserManagement() {
    try {
        hideAllSections();
        document.getElementById('userManagementSection').classList.remove('hidden');

        const [usersResponse, userStatsResponse] = await Promise.all([
            Utils.apiRequest('/api/admin/users'),
            Utils.apiRequest('/api/admin/users/stats')
        ]);


        if (usersResponse.success && userStatsResponse.success) {
            // FIX: Access the correct data structure
            displayUsers(usersResponse.data.users || usersResponse.data);
            displayUserStats(userStatsResponse.data);
        } else {
            throw new Error('Failed to load user data');
        }
    } catch (error) {
        console.error('Failed to load user management:', error);
        showMessage('Failed to load user data: ' + error.message, 'error');
    }
}

function displayUsers(users) {
    const container = document.getElementById('userManagementSection');
    
    // Ensure users is an array
    users = Array.isArray(users) ? users : [];
    
    const usersHTML = `
        <div style="margin-bottom: 20px;">
            <h3>User List (${users.length} users)</h3>
            <div style="max-height: 400px; overflow-y: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Email</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Name</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Role</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Balance</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Joined</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">${user.email || 'N/A'}</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">${user.full_name || 'N/A'}</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">
                                    <span class="badge ${user.role === 'admin' ? 'badge-success' : 'badge-secondary'}">${user.role || 'user'}</span>
                                </td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">${Utils.formatCurrency(user.balance || 0)}</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">${new Date(user.created_at).toLocaleDateString()}</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">
                                    ${user.role === 'user' ? 
                                        `<button class="btn btn-sm" onclick="makeAdmin('${user.id}')">Make Admin</button>` :
                                        `<button class="btn btn-sm btn-secondary" onclick="makeUser('${user.id}')">Make User</button>`
                                    }
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
    
    container.innerHTML = usersHTML;
}                

function displayUserStats(stats) {
    const statsHTML = `
        <div class="stats-grid" style="margin-bottom: 20px;">
            <div class="stat-card">
                <div class="stat-number">${stats.total_users}</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.active_users}</div>
                <div class="stat-label">Active Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.new_users_today}</div>
                <div class="stat-label">New Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.new_users_this_week}</div>
                <div class="stat-label">New This Week</div>
            </div>
        </div>
    `;
    
    document.getElementById('userManagementSection').innerHTML = statsHTML + document.getElementById('userManagementSection').innerHTML;
}

async function makeAdmin(userId) {
    if (!confirm('Are you sure you want to make this user an admin?')) return;
    
    try {
        const response = await Utils.apiRequest(`/api/admin/users/${userId}/role`, {
            method: 'PUT',
            body: JSON.stringify({ role: 'admin' })
        });

        if (response.success) {
            showMessage('User role updated to admin', 'success');
            loadUserManagement();
        } else {
            throw new Error(response.error);
        }
    } catch (error) {
        showMessage('Failed to update user role: ' + error.message, 'error');
    }
}

async function makeUser(userId) {
    if (!confirm('Are you sure you want to make this admin a regular user?')) return;
    
    try {
        const response = await Utils.apiRequest(`/api/admin/users/${userId}/role`, {
            method: 'PUT',
            body: JSON.stringify({ role: 'user' })
        });

        if (response.success) {
            showMessage('User role updated to regular user', 'success');
            loadUserManagement();
        } else {
            throw new Error(response.error);
        }
    } catch (error) {
        showMessage('Failed to update user role: ' + error.message, 'error');
    }
}

// Order Management Functions
async function loadOrderManagement() {
    try {
        hideAllSections();
        document.getElementById('orderManagementSection').classList.remove('hidden');

        const response = await Utils.apiRequest('/api/admin/orders');

        if (response.success) {
            // FIX: Access the correct data structure
            displayOrders(response.data.orders || response.data);
        } else {
            throw new Error('Failed to load orders');
        }
    } catch (error) {
        console.error('Failed to load order management:', error);
        showMessage('Failed to load orders: ' + error.message, 'error');
    }
}

function displayOrders(orders) {
    const container = document.getElementById('orderManagementSection');
    
    // Ensure orders is an array
    orders = Array.isArray(orders) ? orders : [];
    
    const ordersHTML = `
        <div style="max-height: 500px; overflow-y: auto;">
            <h3>Order List (${orders.length} orders)</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">User</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Network</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Plan</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Phone</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Amount</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Status</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Date</th>
                        <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${orders.map(order => `
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">${order.profiles?.email || 'Unknown'}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">${order.networks?.name || 'N/A'}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">${order.data_plans?.name || 'N/A'}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">${order.phone_number}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">${Utils.formatCurrency(order.amount_paid)}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">
                                <span class="badge badge-${getStatusBadgeClass(order.status)}">${order.status}</span>
                            </td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">${new Date(order.created_at).toLocaleDateString()}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">
                                <select onchange="updateOrderStatus('${order.id}', this.value)" style="padding: 5px; border-radius: 3px; border: 1px solid #ddd;">
                                    <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                                    <option value="success" ${order.status === 'success' ? 'selected' : ''}>Success</option>
                                    <option value="failed" ${order.status === 'failed' ? 'selected' : ''}>Failed</option>
                                    <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                </select>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
    
    container.innerHTML = ordersHTML;
}                    

function getStatusBadgeClass(status) {
    const classes = {
        'success': 'success',
        'failed': 'danger',
        'pending': 'warning',
        'processing': 'info',
        'cancelled': 'secondary'
    };
    return classes[status] || 'secondary';
}

async function updateOrderStatus(orderId, status) {
    try {
        const response = await Utils.apiRequest(`/api/admin/orders/${orderId}/status`, {
            method: 'PUT',
            body: JSON.stringify({ status })
        });

        if (response.success) {
            showMessage('Order status updated successfully', 'success');
        } else {
            throw new Error(response.error);
        }
    } catch (error) {
        showMessage('Failed to update order status: ' + error.message, 'error');
    }
}

// System Settings Functions
async function loadSystemSettings() {
    try {
        hideAllSections();
        document.getElementById('systemSettingsSection').classList.remove('hidden');
        
        const response = await Utils.apiRequest('/api/admin/settings');
        if (response.success) {
            displaySystemSettings(response.data);
        } else {
            throw new Error('Failed to load system settings');
        }
    } catch (error) {
        console.error('Failed to load system settings:', error);
        showMessage('Failed to load system settings: ' + error.message, 'error');
    }
}

function displaySystemSettings(data) {
    const container = document.getElementById('systemSettingsSection');
    const settings = data.settings || {};
    
    const settingsHTML = `
        <div style="max-width: 600px;">
            <h3>System Configuration</h3>
            <div class="form-group">
                <label>Site Name:</label>
                <input type="text" id="appName" class="form-control" value="${settings.site_name || 'KaosSub'}" placeholder="Site Name">
            </div>
            <div class="form-group">
                <label>Currency:</label>
                <input type="text" id="currency" class="form-control" value="${settings.currency || 'NGN'}" placeholder="Currency">
            </div>
            <div class="form-group">
                <label>Max Orders Per User:</label>
                <input type="number" id="maxOrders" class="form-control" value="${settings.max_orders_per_user || '10'}" placeholder="10" min="1" max="100">
            </div>
            <div class="form-group">
                <label>Maintenance Mode:</label>
                <select id="maintenanceMode" class="form-control">
                    <option value="false" ${!settings.maintenance_mode ? 'selected' : ''}>Disabled</option>
                    <option value="true" ${settings.maintenance_mode ? 'selected' : ''}>Enabled</option>
                </select>
            </div>
            <div class="form-group">
                <label>Registration Enabled:</label>
                <select id="registrationEnabled" class="form-control">
                    <option value="true" ${settings.registration_enabled !== false ? 'selected' : ''}>Enabled</option>
                    <option value="false" ${settings.registration_enabled === false ? 'selected' : ''}>Disabled</option>
                </select>
            </div>
            <button class="btn btn-success" onclick="saveSystemSettings()">Save Settings</button>
        </div>
    `;
    
    container.innerHTML = settingsHTML;
}

async function saveSystemSettings() {
    try {
        const settings = {
            app_name: document.getElementById('appName').value,
            support_email: document.getElementById('supportEmail').value,
            commission_rate: document.getElementById('commissionRate').value,
            maintenance_mode: document.getElementById('maintenanceMode').value
        };

        const response = await Utils.apiRequest('/api/admin/settings', {
            method: 'PUT',
            body: JSON.stringify({ settings })
        });

        if (response.success) {
            showMessage('System settings saved successfully', 'success');
        } else {
            throw new Error(response.error);
        }
    } catch (error) {
        showMessage('Failed to save settings: ' + error.message, 'error');
    }
}


// Session management functions
const AdminSession = {
    // Save admin session
    saveSession: function(sessionData) {
        try {
            const session = {
                ...sessionData,
                created_at: new Date().toISOString()
            };
            sessionStorage.setItem('adminSession', JSON.stringify(session));
        } catch (error) {
            console.error('‚ùå Failed to save admin session:', error);
        }
    },

    // Get admin session
    getSession: function() {
        try {
            const session = sessionStorage.getItem('adminSession');
            if (!session) return null;
            
            const sessionData = JSON.parse(session);
            
            // Check if session is expired
            if (this.isSessionExpired(sessionData)) {
                this.clearSession();
                return null;
            }
            
            return sessionData;
        } catch (error) {
            console.error('‚ùå Failed to get admin session:', error);
            return null;
        }
    },

    // Check if session is expired (8 hours)
    isSessionExpired: function(sessionData) {
        if (!sessionData.created_at) return true;
        
        const sessionTime = new Date(sessionData.created_at);
        const currentTime = new Date();
        const hoursDiff = (currentTime - sessionTime) / (1000 * 60 * 60);
        
        return hoursDiff > 8; // 8 hours expiry
    },

    // Clear admin session
    clearSession: function() {
        sessionStorage.removeItem('adminSession');
    },

    // Check if user has valid admin session
    hasValidSession: function() {
        return this.getSession() !== null;
    }
};

// Admin logout function
function adminLogout() {
    if (confirm('Are you sure you want to logout from admin dashboard?')) {
        AdminSession.clearSession();
        window.location.reload();
    }
}
</script>
    <!-- Load Footer Component -->
    <script src="/js/components/footer.js"></script>
    
    <!-- Form Handler -->
    <!-- Hamburger Menu -->
    <script src="/js/components/hamburger-menu.js"></script>
    <script src="/js/components/simple-form-handler.js"></script>
    <!-- Form Handler -->
</body>
</html>
